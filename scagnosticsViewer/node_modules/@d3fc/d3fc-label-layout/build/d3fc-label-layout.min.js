(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-selection"),require("d3-scale"),require("@d3fc/d3fc-data-join"),require("@d3fc/d3fc-rebind"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-scale","@d3fc/d3fc-data-join","@d3fc/d3fc-rebind","d3-array"],b):(a=a||self,b(a.fc=a.fc||{},a.d3,a.d3,a.fc,a.fc,a.d3))})(this,function(a,b,c,d,e,f){'use strict';function g(a){return h(a)||i(a)||j()}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function i(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function j(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var k=function(a){return"function"==typeof a?a:function(){return a}},l=function(c,a){return!(c.x>=a.x+a.width||c.x+c.width<=a.x||c.y>=a.y+a.height||c.y+c.height<=a.y)},m=function(c,a){var b=Math.min,d=Math.max;if(l(c,a)){var e=d(c.x,a.x),f=b(c.x+c.width,a.x+a.width),g=d(c.y,a.y),h=b(c.y+c.height,a.y+a.height);return(f-e)*(h-g)}return 0},n=function(a,b){return f.sum(a.map(function(c,d){return b===d?0:m(a[b],c)}))},o=function(a,b,c,d,e){return{x:a,y:b,width:c,height:d,location:e}},p=function(a){var b=a.x,c=a.y,d=a.width,e=a.height;return[o(b,c,d,e,"bottom-right"),o(b-d,c,d,e,"bottom-left"),o(b-d,c-e,d,e,"top-left"),o(b,c-e,d,e,"top-right"),o(b,c-e/2,d,e,"middle-right"),o(b-d/2,c,d,e,"bottom-center"),o(b-d,c-e/2,d,e,"middle-left"),o(b-d/2,c-e,d,e,"top-center")]},q=function(a,b,c){return[].concat(g(a.slice(0,b)),[c],g(a.slice(b+1)))},r=function(c,a){return c<a},s=function a(){var b,c=null,d=r,e=function(){return 0},g=function(a,d){return c-e(b[d],d,b)+e(a,d,q(b,d,a))},h=function h(i,j){c||(c=f.sum(b.map(function(a,c){return e(a,c,b)})));var k=g(i,j);return d(k,c)?a().locationScore(e).winningScore(d).score(k).rectangles(q(b,j,i)):h};return h.rectangles=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],h):b},h.score=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],h):c},h.winningScore=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],h):d},h.locationScore=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],h):e},h},t=function(a){return a[u(a)]},u=function(a){return Math.floor(Math.random()*a.length)},v=function(a,b){return a[f.scan(a,b)]};a.layoutAnnealing=function(){var a,b=1e3,c=1,d=function(a){switch(a.location){case"bottom-right":return 0;case"middle-right":case"bottom-center":return a.width*a.height/8;}return a.width*a.height/4},e=function(b){return a?b.width*b.height-m(b,a):0},f=function(a,b,c){return n(c,b)+e(a)+d(a)},g=function(a){for(var d=b,e=function(a,b){var c=Math.exp;return c((b-a)/d)>Math.random()},g=s().locationScore(f).winningScore(e).rectangles(a);0<d;){var h=u(a),i=t(p(a[h]));g=g(i,h),d-=c}return g.rectangles()};return g.temperature=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],g):b},g.cooling=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],g):c},g.bounds=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],g):a},g},a.layoutBoundingBox=function(){var a=[0,0],b=function(b){return b.map(function(b){var c=b.x,d=b.y;return c+b.width>a[0]&&(c-=b.width),d+b.height>a[1]&&(d-=b.height),{height:b.height,width:b.width,x:c,y:d}})};return b.bounds=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],b):a},b},a.layoutGreedy=function(){var a,b=function(b){return a?b.width*b.height-m(b,a):0},c=function(a,c,d){return n(d,c)+b(a)},d=function(a){var b=s().locationScore(c).rectangles(a);return a.forEach(function(a,c){p(a).forEach(function(a){b=b(a,c)})}),b.rectangles()};return d.bounds=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],d):a},d},a.layoutLabel=function(a){var f=function(){},g=function(){return[0,0]},h=function(a){return[a.x,a.y]},i=a||function(a){return a},j=function(){},l=c.scaleIdentity(),m=c.scaleIdentity(),n=d.dataJoin("g","label"),o=function(a){a.each(function(a,c,d){var e=n(b.select(d[c]),a).call(j),k=e.nodes(),o=k.map(function(a,c){var e=b.select(a).datum(),d=h(e,c,k),f=[l(d[0]),m(d[1])],i=g(e,c,k);return{hidden:!1,x:f[0],y:f[1],width:i[0],height:i[1]}}),p=i(o);e.attr("style",function(a,b){return"display:"+(p[b].hidden?"none":"inherit")}).attr("transform",function(a,b){return"translate("+p[b].x+", "+p[b].y+")"}).attr("layout-width",function(a,b){return p[b].width}).attr("layout-height",function(a,b){return p[b].height}).attr("anchor-x",function(a,b){return o[b].x-p[b].x}).attr("anchor-y",function(a,b){return o[b].y-p[b].y}),e.call(j),f(e,a,c)})};return e.rebindAll(o,n,e.include("key")),e.rebindAll(o,i),o.size=function(){return arguments.length?(g=k(0>=arguments.length?void 0:arguments[0]),o):g},o.position=function(){return arguments.length?(h=k(0>=arguments.length?void 0:arguments[0]),o):h},o.component=function(){return arguments.length?(j=0>=arguments.length?void 0:arguments[0],o):j},o.decorate=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],o):f},o.xScale=function(){return arguments.length?(l=0>=arguments.length?void 0:arguments[0],o):l},o.yScale=function(){return arguments.length?(m=0>=arguments.length?void 0:arguments[0],o):m},o},a.layoutRemoveOverlaps=function(a){a=a||function(a){return a};var b=function(b){b=a(b);for(var c,d=function(){var a=b.filter(function(a){return!a.hidden}),c=a.map(function(b,c){return[b,n(a,c)]}),d=v(c,function(c,a){return a[1]-c[1]});return 0<d[1]?void(d[0].hidden=!0):"break"};c=d(),"break"!==c;);return b};return e.rebindAll(b,a),b},a.layoutTextLabel=function(){var a=2,c=function(a){return a},e=d.dataJoin("text"),f=d.dataJoin("rect"),g=d.dataJoin("circle"),h=function(d){d.each(function(d,h,i){var j=i[h],k=b.select(j),l=+j.getAttribute("layout-width"),m=+j.getAttribute("layout-height"),n=f(k,[d]);n.attr("width",l).attr("height",m);var o=+j.getAttribute("anchor-x"),p=+j.getAttribute("anchor-y"),q=g(k,[d]);q.attr("r",2).attr("cx",o).attr("cy",p);var r=e(k,[d]);r.enter().attr("dy","0.9em").attr("transform","translate(".concat(a,", ").concat(a,")")),r.text(c)})};return h.padding=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],h):a},h.value=function(){return arguments.length?(c=k(0>=arguments.length?void 0:arguments[0]),h):c},h},Object.defineProperty(a,"__esModule",{value:!0})});
