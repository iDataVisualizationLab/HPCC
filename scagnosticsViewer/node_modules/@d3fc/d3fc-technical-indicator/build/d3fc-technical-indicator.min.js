(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-array"),require("@d3fc/d3fc-rebind")):"function"==typeof define&&define.amd?define(["exports","d3-array","@d3fc/d3fc-rebind"],b):(a=a||self,b(a.fc=a.fc||{},a.d3,a.fc))})(this,function(a,b,c){'use strict';function d(a){return a}function e(){}function f(a){return"function"==typeof a?a:function(){return a}}function g(a){return"number"==typeof a&&isNaN(a)?void 0:a}function h(){var a=function(){return 10},b=e,c=d,g=function(a){return null!=a},h=function(d){var e=a.apply(this,arguments),f=d.slice(0,e).map(c);return d.map(function(a,d){return d>=e&&(f.shift(),f.push(c(a,d))),d<e-1||f.some(function(a){return!g(a)})?b(void 0,d):b(f,d)})};return h.period=function(){return arguments.length?(a=f(0>=arguments.length?void 0:arguments[0]),h):a},h.accumulator=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],h):b},h.defined=function(){return arguments.length?(g=0>=arguments.length?void 0:arguments[0],h):g},h.value=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],h):c},h}function i(){var a=2,d=h().accumulator(function(c){var d=c&&b.deviation(c),e=c&&b.mean(c);return{average:e,upper:g(e+a*d),lower:g(e-a*d)}}),e=function(a){return d(a)};return e.multiplier=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],e):a},c.rebind(e,d,"period","value"),e}function j(){var a=d,c=function(){return 9},e=function(a){var c=[];return function(d){var e;return c.length<a&&(null==d?c=[]:c.push(d)),c.length>=a&&(e=b.mean(c)),e}},h=function(b){var f,h=c.apply(this,arguments),j=2/(h+1),k=e(h);return b.map(function(b,c){var d=a(b,c);return f=void 0===f?k(d):d*j+(1-j)*f,g(f)})};return h.period=function(){return arguments.length?(c=f(0>=arguments.length?void 0:arguments[0]),h):c},h.value=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],h):a},h}function k(){var a=d,e=j().period(12),f=j().period(26),g=j().period(9),h=function(c){e.value(a),f.value(a);var d=b.zip(e(c),f(c)).map(function(a){return void 0!==a[0]&&void 0!==a[1]?a[0]-a[1]:void 0}),h=g(d);return b.zip(d,h).map(function(a){return{macd:a[0],signal:a[1],divergence:void 0!==a[0]&&void 0!==a[1]?a[0]-a[1]:void 0}})};return h.value=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],h):a},c.rebindAll(h,e,c.includeMap({period:"fastPeriod"})),c.rebindAll(h,f,c.includeMap({period:"slowPeriod"})),c.rebindAll(h,g,c.includeMap({period:"signalPeriod"})),h}function l(a,b){return o(a)||q(a,b)||s()}function m(a){return n(a)||p(a)||r()}function n(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function o(a){if(Array.isArray(a))return a}function p(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function q(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function t(){var a=h().accumulator(function(a){return a&&b.mean(a)}),d=function(b){return a(b)};return c.rebind(d,a,"period","value"),d}function u(){var a=.1,b=d,c=function(c){return c.map(function(c){var d=g(b(c)*(1-a)),e=g(b(c)*(1+a));return{lower:d,upper:e}})};return c.factor=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],c):a},c.value=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],c):b},c}function v(){var a=function(a){return a.close},e=function(a){return a.high},f=function(a){return a.low},h=j().period(13),i=function(c){return h.value(a),b.zip(c,h(c)).map(function(a){var b=g(e(a[0])-a[1]),c=g(f(a[0])-a[1]);return{bullPower:b,bearPower:c}})};return i.closeValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],i):a},i.highValue=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],i):e},i.lowValue=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],i):f},c.rebind(i,h,"period"),i}a.indicatorBollingerBands=i,a.indicatorElderRay=v,a.indicatorEnvelope=u,a.indicatorExponentialMovingAverage=j,a.indicatorForceIndex=function(){var a=function(a){return a.volume},b=function(a){return a.close},d=j().period(13),e=h().period(2).defined(function(c){return null!=b(c)&&null!=a(c)}).accumulator(function(c){return c&&g((b(c[1])-b(c[0]))*a(c[1]))}),f=function(a){var b=e(a);return d(b)};return f.volumeValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],f):a},f.closeValue=function(){return arguments.length?(b=0>=arguments.length?void 0:arguments[0],f):b},c.rebind(f,d,"period"),f},a.indicatorMacd=k,a.indicatorMovingAverage=t,a.indicatorRelativeStrengthIndex=function(){var a=h().period(14),d=function(a,b){return b+(a[a.length-1]-b)/a.length},e=function(a){var b=l(a,2),c=b[0],d=b[1];return c<d?0:c-d},f=function(a){var b=l(a,2),c=b[0],d=b[1];return c>d?0:d-c},i=function(a,c){return void 0===c?b.mean(a):d(a,c)},j=function(){var a,c,d;return function(h){if(!h)return void(void 0!==a&&(a=NaN));if(void 0===a)return void(a=h[0]);var j=b.pairs([a].concat(m(h)));c=i(j.map(e),c),d=i(j.map(f),d);var k=isNaN(a)?NaN:d/c;return g(100-100/(1+k))}},k=function(b){var c=j();return a.accumulator(c),a(b)};return c.rebind(k,a,"period","value"),k},a.indicatorStochasticOscillator=function(){var a=function(a){return a.close},e=function(a){return a.high},f=function(a){return a.low},i=h().period(5).defined(function(b){return null!=a(b)&&null!=e(b)&&null!=f(b)}).accumulator(function(c){var d=c&&b.max(c,e),h=c&&b.min(c,f),i=c&&100*(a(c[c.length-1])-h)/(d-h);return g(i)}),j=t().period(3),k=function(a){var b=i(a),c=j(b);return b.map(function(a,b){return{k:a,d:c[b]}})};return k.closeValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],k):a},k.highValue=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],k):e},k.lowValue=function(){return arguments.length?(f=0>=arguments.length?void 0:arguments[0],k):f},c.rebindAll(k,i,c.includeMap({period:"kPeriod"})),c.rebindAll(k,j,c.includeMap({period:"dPeriod"})),k},Object.defineProperty(a,"__esModule",{value:!0})});
